version: "3.8"

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "8080:80"
    depends_on:
      - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5050:5000"
    environment:
      # à¸šà¸±à¸‡à¸„à¸±à¸šà¹ƒà¸«à¹‰à¸Ÿà¸±à¸‡à¸—à¸µà¹ˆ 0.0.0.0 (IPv4) à¸žà¸­à¸£à¹Œà¸• 5000 à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Container à¸­à¸·à¹ˆà¸™à¸¡à¸­à¸‡à¹€à¸«à¹‡à¸™
      - ASPNETCORE_URLS=http://0.0.0.0:5000
      - ConnectionStrings__DefaultConnection=Host=db;Port=5432;Database=monitoring;Username=spkz14;Password=123456za
    depends_on:
      - db

  # ðŸ”´ Agent 1: PING
  agent-ping:
    build:
      context: .
      dockerfile: Dockerfile.agent
    restart: always
    environment:
      - DOTNET_RunningInContainer=true
      - AGENT_NAME=Ping Agent (Agent 1)
      - AGENT_MODE=PING
    depends_on:
      - backend

  # ðŸŸ¢ Agent 2: HTTP
  agent-http:
    build:
      context: .
      dockerfile: Dockerfile.agent
    restart: always
    environment:
      - DOTNET_RunningInContainer=true
      - AGENT_NAME=HTTP Agent (Agent 2)
      - AGENT_MODE=HTTP
    depends_on:
      - backend

  # ðŸ”µ Agent 3: TRACEROUTE
  agent-trace:
    build:
      context: .
      dockerfile: Dockerfile.agent
    restart: always
    user: root
    environment:
      - DOTNET_RunningInContainer=true
      - AGENT_NAME=Trace Agent (Agent 3)
      - AGENT_MODE=TRACEROUTE
    depends_on:
      - backend

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: spkz14
      POSTGRES_PASSWORD: 123456za
      POSTGRES_DB: monitoring
    ports:
      - "15432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
